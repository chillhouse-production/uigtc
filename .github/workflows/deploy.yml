name: Deploy Frontend

on:
  push:
    branches: [ main ] # Atau master

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Install Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: Install Dependencies & Build
      run: |
        npm install
        npm run build
      # Pastikan output build kamu ada di folder 'dist' atau 'build'
      # Sesuaikan nama folder di langkah bawah (misal: build/ atau dist/)

    - name: Deploy to VPS via SCP
      uses: appleboy/scp-action@master
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USERNAME }}
        key: ${{ secrets.VPS_SSH_KEY }}
        source: "dist/*" # Sesuaikan dengan folder output build React (biasanya 'dist' atau 'build')
        target: "/var/www/frontend"
        strip_components: 1 # Agar folder 'dist' tidak ikut ter-copy, hanya isinya